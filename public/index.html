<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="theme-color" content="#f9fafb" />
		<title>WalletWise Journal</title>

		<link rel="icon" type="image/svg+xml" href="favicon/favicon.svg" />
		<link
			rel="icon"
			type="image/png"
			href="favicon/favicon-96x96.png"
			sizes="96x96"
		/>
		<link rel="shortcut icon" href="favicon/favicon.ico" />
		<link
			rel="apple-touch-icon"
			sizes="180x180"
			href="favicon/apple-touch-icon.png"
		/>
		<link rel="manifest" href="favicon/site.webmanifest" />
		<meta name="apple-mobile-web-app-title" content="WalletWise" />

		<noscript>
			<link
				rel="stylesheet"
				href="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.11.6/viewer.min.css"
			/>
			<link
				rel="stylesheet"
				href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
			/>
		</noscript>

		<style>
			body {
				visibility: hidden;
				opacity: 0;
				transition: opacity 0.3s ease-in-out; /* ふわっと表示させる */
			}
		</style>
	</head>
	<body class="bg-neutral-50 text-neutral-800">
		<noscript>
			<style>
				/* JS無効時はbodyを表示するが、アプリのコンテンツは隠す */
				body {
					visibility: visible !important;
					opacity: 1 !important;
				}
				/* アプリのメインコンテンツを隠す */
				#app-container,
				#menu-panel,
				#menu-overlay,
				#notification-banner,
				#transaction-modal,
				#guide-modal,
				#settings-modal,
				#icon-picker-modal,
				#scan-start-modal,
				#scan-confirm-modal,
				#report-modal {
					display: none !important;
				}
				/* noscriptの内容を見やすく表示 */
				.noscript-content {
					position: fixed;
					top: 0;
					left: 0;
					width: 100%;
					height: 100%;
					display: flex;
					flex-direction: column;
					align-items: center;
					justify-content: center;
					background-color: #f9fafb;
					z-index: 9999;
					padding: 24px;
					text-align: center;
					font-family: system-ui, -apple-system, sans-serif;
					box-sizing: border-box;
				}
				.noscript-icon {
					font-size: 3rem;
					color: #dc2626;
					margin-bottom: 1.5rem;
				}
				.noscript-title {
					font-size: 1.5rem;
					font-weight: bold;
					color: #1f2937;
					margin-bottom: 1rem;
					line-height: 1.3;
				}
				.noscript-text {
					color: #4b5563;
					line-height: 1.6;
					max-width: 500px;
					margin: 0 auto;
					font-size: 1rem;
				}
				/* スマホ向けの調整 */
				@media (max-width: 640px) {
					.noscript-icon {
						font-size: 2.5rem;
						margin-bottom: 1rem;
					}
					.noscript-title {
						font-size: 1.25rem;
					}
					.noscript-text {
						font-size: 0.875rem;
					}
				}
			</style>
			<div class="noscript-content">
				<i class="fas fa-exclamation-triangle noscript-icon"></i>
				<h2 class="noscript-title">JavaScriptが必要です</h2>
				<p class="noscript-text">
					WalletWise
					Journalを利用するには、ブラウザの設定でJavaScriptを有効にしてください。
				</p>
			</div>
		</noscript>

		<div
			id="notification-banner"
			hidden
			class="fixed top-0 left-0 right-0 p-4 z-50 text-center text-white transition-transform duration-300 -translate-y-full"
		>
			<p id="notification-message"></p>
		</div>

		<div id="app-container" class="max-w-4xl mx-auto px-4 md:px-6 pb-4 md:pb-6">
			<header
				class="sticky top-0 z-30 flex items-center justify-between bg-neutral-50 py-2 border-b border-neutral-200 mb-6 h-16 transform-gpu"
			>
				<div id="side-menu-container"></div>

				<div
					class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 flex items-center justify-center gap-2 w-full max-w-[calc(100%-100px)] md:static md:w-auto md:max-w-none md:justify-start md:grow md:ml-3 md:translate-x-0 md:translate-y-0"
				>
					<img
						src="favicon/favicon-96x96.png"
						alt="Logo"
						class="w-8 h-8 shrink-0 rounded-lg"
						width="32"
						height="32"
					/>
					<h1
						class="text-xl md:text-2xl font-bold tracking-tight truncate text-center md:text-left"
					>
						<span
							class="bg-clip-text text-transparent bg-linear-to-r from-primary to-violet-600"
							>WalletWise</span
						>
						<span class="text-neutral-800">Journal</span>
					</h1>
				</div>

				<div class="flex items-center gap-3 shrink-0 z-20 ml-auto md:ml-0">
					<div class="hidden md:block">
						<p
							id="last-updated-time"
							hidden
							class="text-xs text-neutral-400 whitespace-nowrap"
						>
							データ取得中...
						</p>
					</div>

					<button
						id="refresh-data-button"
						aria-label="データを更新する"
						hidden
						class="w-10 h-10 flex items-center justify-center rounded-full text-primary bg-white shadow-sm hover:bg-primary-light transition-all active:scale-95"
						title="データを更新"
					>
						<i id="refresh-icon" class="fas fa-sync-alt text-lg"></i>
					</button>
				</div>
			</header>

			<div id="auth-screen" class="text-center py-20">
				<div id="auth-container">
					<div id="loading-indicator">
						<i class="fas fa-spinner fa-spin text-4xl text-primary"></i>
						<p class="mt-4 text-lg">認証情報を確認しています...</p>
					</div>
					<div id="update-indicator" hidden>
						<i class="fas fa-sync-alt fa-spin text-4xl text-primary"></i>
						<p class="mt-4 text-lg">アプリを更新しています...</p>
					</div>
					<div id="login-container" hidden>
						<h2 class="text-2xl font-bold mb-4">おかえりなさい</h2>
						<p class="text-neutral-800 mb-8">
							データを表示するにはログインしてください。
						</p>
						<button
							id="login-button"
							class="bg-white text-neutral-800 font-semibold py-3 px-6 rounded-lg shadow-md border border-neutral-200 hover:bg-neutral-100 transition inline-flex items-center"
						>
							<img
								src="https://www.google.com/favicon.ico"
								alt="Google"
								class="w-6 h-6 mr-3"
							/>
							Googleアカウントでログイン
						</button>
					</div>
					<p class="text-xs text-neutral-400 mt-8">
						This site is protected by reCAPTCHA and the Google
						<a
							href="https://policies.google.com/privacy"
							target="_blank"
							class="underline hover:text-neutral-600"
							>Privacy Policy</a
						>
						and
						<a
							href="https://policies.google.com/terms"
							target="_blank"
							class="underline hover:text-neutral-600"
							>Terms of Service</a
						>
						apply.
					</p>
				</div>
			</div>

			<main id="main-content" hidden>
				<section id="home-section" class="mb-8">
					<h2
						class="text-lg md:text-xl font-bold text-neutral-900 border-l-4 border-primary pl-3 mb-4"
					>
						資産一覧
					</h2>

					<div id="dashboard-total-assets" class="mb-6">
						<div
							class="bg-linear-to-r from-primary to-violet-600 rounded-xl p-6 text-white shadow-lg"
						>
							<div
								class="flex flex-col md:flex-row md:items-end md:justify-between gap-4"
							>
								<div>
									<h3 class="text-white/80 text-sm font-medium mb-1">
										純資産 (資産 - 負債)
									</h3>
									<p
										id="dashboard-net-worth"
										class="text-3xl md:text-4xl font-bold tracking-tight"
									>
										---
									</p>
								</div>

								<div
									class="flex gap-6 text-sm border-t md:border-t-0 md:border-l border-white/30 pt-4 md:pt-0 md:pl-6"
								>
									<div>
										<span class="block text-white/60 text-xs">総資産</span>
										<span
											id="dashboard-gross-assets"
											class="block font-bold text-lg"
											>---</span
										>
									</div>
									<div>
										<span class="block text-white/60 text-xs">総負債</span>
										<span
											id="dashboard-gross-liabilities"
											class="block font-bold text-lg"
											>---</span
										>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div id="ai-advisor-card-container"></div>

					<div
						id="balances-grid"
						class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3"
					></div>
				</section>

				<section id="assets-history-section" class="mb-8 scroll-mt-20">
					<h2
						class="text-lg md:text-xl font-bold text-neutral-900 border-l-4 border-primary pl-3 mb-4"
					>
						資産推移
					</h2>
					<div class="bg-white p-4 md:p-6 rounded-xl shadow-sm">
						<div class="scroll-hint-wrapper w-full">
							<div
								class="overflow-x-auto md:overflow-x-visible no-scrollbar flex"
								id="history-chart-scroll-container"
							>
								<div id="history-chart-container" class="w-full"></div>
							</div>
						</div>
						<p
							id="history-chart-placeholder"
							hidden
							class="text-neutral-500 text-center py-10"
						>
							取引データがありません
						</p>
					</div>
				</section>

				<section id="analysis-section" class="mb-8 scroll-mt-20">
					<div class="flex justify-between items-center mb-4">
						<h2
							class="text-lg md:text-xl font-bold text-neutral-900 border-l-4 border-primary pl-3"
						>
							収支レポート
						</h2>
						<ww-select
							id="analysis-month-filter"
							aria-label="収支レポートの表示月"
							class="h-9 w-40"
						></ww-select>
					</div>

					<div class="bg-white p-4 md:p-6 rounded-xl shadow-sm space-y-6">
						<div id="analysis-math-summary"></div>
						<div class="scroll-hint-wrapper md:mx-0 md:px-0">
							<div
								id="analysis-details-container"
								class="flex gap-3 overflow-x-auto no-scrollbar pb-2"
							></div>
						</div>
					</div>
				</section>

				<section id="billing-section" class="mb-6">
					<h2
						class="text-lg md:text-xl font-bold mb-4 text-neutral-900 border-l-4 border-primary pl-3"
					>
						次回のカード支払い予定
					</h2>
					<div id="billing-list" class="space-y-4"></div>
				</section>

				<section id="transactions-section">
					<div class="flex justify-between items-center mb-4">
						<h2
							class="text-lg md:text-xl font-bold text-neutral-900 border-l-4 border-primary pl-3"
						>
							取引履歴
						</h2>
						<ww-select
							id="month-filter"
							aria-label="取引履歴の表示月"
							class="h-9 w-40"
						></ww-select>
					</div>
					<div
						id="filter-section"
						class="bg-white p-4 rounded-xl shadow-sm mb-4 flex flex-wrap items-center gap-x-4 gap-y-3"
					>
						<ww-select
							id="type-filter"
							aria-label="取引種別で絞り込む"
							class="w-full sm:w-auto grow"
						></ww-select>
						<ww-select
							id="category-filter"
							aria-label="カテゴリで絞り込む"
							class="w-full sm:w-auto grow"
						></ww-select>
						<ww-select
							id="payment-method-filter"
							aria-label="支払方法で絞り込む"
							class="w-full sm:w-auto grow"
						></ww-select>
						<div class="w-full md:w-auto grow flex items-center gap-2">
							<div class="grow">
								<ww-input
									id="search-input"
									type="text"
									placeholder="キーワードで検索..."
								></ww-input>
							</div>
							<ww-button
								id="reset-filters-button"
								variant="secondary"
								extra-class="h-9 px-3 whitespace-nowrap bg-neutral-200 border-neutral-200 hover:bg-neutral-300"
								aria-label="フィルターをリセット"
							>
								リセット
							</ww-button>
						</div>
					</div>
					<div id="transactions-list" class="space-y-3"></div>
					<p
						id="no-transactions-message"
						hidden
						class="text-center text-neutral-500 py-8"
					>
						この月の取引はありません。
					</p>
				</section>

				<div
					class="fixed bottom-6 right-6 z-40 flex flex-col gap-4 items-center"
				>
					<button
						id="scan-receipt-fab"
						aria-label="AIでレシートをスキャンする"
						class="ai-rainbow-btn w-14 h-14 flex items-center justify-center shadow-lg rounded-full"
						title="AIで画像を読み取る"
					>
						<i class="fas fa-camera text-xl"></i>
					</button>

					<button
						id="add-transaction-button"
						aria-label="新しい取引を追加する"
						class="indigo-ring-btn w-16 h-16 flex items-center justify-center shadow-lg"
						title="取引を手動入力"
					>
						<i class="fas fa-plus text-2xl"></i>
					</button>

					<input type="file" id="receipt-file-input" accept="image/*" hidden />
				</div>
			</main>
		</div>

		<div
			id="transaction-modal"
			hidden
			class="fixed inset-0 modal-overlay z-50 flex justify-center items-center p-4"
		>
			<div
				class="bg-white rounded-lg shadow-xl w-full max-w-lg max-h-full overflow-y-auto"
			>
				<form id="transaction-form" class="p-6">
					<div class="flex justify-between items-center mb-6">
						<h2 id="modal-title" class="text-2xl font-bold text-neutral-900">
							取引を追加
						</h2>
						<ww-button
							id="close-modal-button"
							variant="icon"
							class="text-neutral-400 hover:text-neutral-600"
							extra-class="w-8 h-8 rounded-full p-1"
							aria-label="閉じる"
						>
							<i class="fas fa-times text-2xl"></i>
						</ww-button>
					</div>

					<div class="space-y-4">
						<input type="hidden" id="transaction-id" name="transaction-id" />
						<input type="hidden" name="type" value="expense" />

						<div
							id="type-selector"
							class="flex bg-white rounded-lg border border-neutral-200 p-1 h-10"
						>
							<button
								type="button"
								data-type="expense"
								aria-label="取引種別を支出に設定"
								class="type-btn flex-1 py-1 text-sm font-bold rounded transition"
							>
								支出
							</button>
							<button
								type="button"
								data-type="income"
								aria-label="取引種別を収入に設定"
								class="type-btn flex-1 py-1 text-sm font-bold rounded transition"
							>
								収入
							</button>
							<button
								type="button"
								data-type="transfer"
								aria-label="取引種別を振替に設定"
								class="type-btn flex-1 py-1 text-sm font-bold rounded transition"
							>
								振替
							</button>
						</div>

						<div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
							<div>
								<ww-input
									id="date"
									name="date"
									type="date"
									label="日付"
									required
								></ww-input>
							</div>
							<div>
								<ww-input
									id="amount"
									name="amount"
									type="tel"
									inputmode="decimal"
									label="金額"
									placeholder="0"
									required
								></ww-input>
							</div>
						</div>

						<div class="grid grid-cols-2 gap-3">
							<div id="payment-method-field">
								<ww-select
									id="payment-method"
									name="payment-method"
									label="支払方法"
									aria-label="支払方法"
								></ww-select>
							</div>
							<div id="category-field">
								<ww-select
									id="category"
									name="category"
									label="カテゴリ"
									aria-label="カテゴリ"
								></ww-select>
							</div>
							<div id="transfer-from-field" hidden>
								<ww-select
									id="transfer-from"
									name="transfer-from"
									label="振替元"
									aria-label="振替元口座"
								></ww-select>
							</div>
							<div id="transfer-to-field" hidden>
								<ww-select
									id="transfer-to"
									name="transfer-to"
									label="振替先"
									aria-label="振替先口座"
								></ww-select>
							</div>
						</div>

						<div>
							<ww-input
								id="description"
								name="description"
								type="text"
								label="詳細 (任意)"
								placeholder="店名や内容など"
							></ww-input>
						</div>
						<div>
							<ww-input
								id="memo"
								name="memo"
								type="text"
								label="メモ (任意)"
								placeholder="メモやタグなど"
							></ww-input>
						</div>
					</div>

					<div
						class="flex justify-end gap-3 pt-6 mt-6 border-t border-neutral-200"
					>
						<ww-button
							id="delete-transaction-button"
							variant="danger-ghost"
							hidden
							aria-label="この取引を削除する"
						>
							削除
						</ww-button>
						<ww-button
							id="copy-transaction-button"
							variant="secondary"
							hidden
							aria-label="この取引を複製する"
						>
							<i class="fas fa-copy mr-2"></i>複製
						</ww-button>
						<ww-button
							id="save-transaction-button"
							variant="primary"
							type="button"
							aria-label="取引を保存する"
						>
							保存
						</ww-button>
					</div>
				</form>
			</div>
		</div>

		<div
			id="guide-modal"
			hidden
			class="fixed inset-0 modal-overlay z-50 flex justify-center items-center p-0 md:p-4"
		>
			<div
				class="bg-white w-full h-full md:h-[80vh] md:max-w-4xl md:rounded-2xl md:shadow-2xl flex flex-col overflow-hidden relative"
			>
				<div class="absolute top-4 right-4 z-10">
					<ww-button
						id="close-guide-modal-button"
						variant="icon"
						extra-class="w-10 h-10 bg-white/80 hover:bg-white shadow-sm backdrop-blur-sm"
						aria-label="ガイドを閉じる"
					>
						<i class="fas fa-times text-2xl"></i>
					</ww-button>
				</div>
				<div class="grow relative overflow-hidden w-full">
					<div
						id="guide-content-container"
						class="absolute inset-0 w-full h-full"
					>
						<p class="p-6 flex items-center justify-center h-full">
							読み込み中...
						</p>
					</div>
				</div>
			</div>
		</div>

		<div
			id="settings-modal"
			hidden
			class="fixed inset-0 modal-overlay z-50 flex justify-center items-center p-4"
		>
			<div
				class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col"
			>
				<div
					id="settings-header"
					class="p-4 border-b border-neutral-200 flex items-center shrink-0 md:rounded-t-lg"
				>
					<ww-button
						id="settings-back-button"
						variant="icon"
						extra-class="text-primary hover:text-primary-dark font-bold pr-4 transition-colors"
						hidden
						aria-label="前の画面に戻る"
					>
						<i class="fas fa-chevron-left"></i>戻る
					</ww-button>

					<div class="flex items-center gap-3">
						<i class="fas fa-cog text-primary text-xl"></i>
						<h2 id="settings-title" class="text-xl font-bold text-neutral-900">
							設定
						</h2>
					</div>

					<ww-button
						id="close-settings-modal-button"
						variant="icon"
						class="ml-auto"
						aria-label="設定を閉じる"
					>
						<i class="fas fa-times text-2xl"></i>
					</ww-button>
				</div>

				<div class="grow overflow-y-auto">
					<div id="settings-menu" class="p-2">
						<a
							href="#settings-general"
							class="settings-menu-link block p-4 rounded-lg hover:bg-neutral-100"
							>一般設定</a
						>
						<a
							href="#settings-accounts"
							class="settings-menu-link block p-4 rounded-lg hover:bg-neutral-100"
							>口座の管理</a
						>
						<a
							href="#settings-categories"
							class="settings-menu-link block p-4 rounded-lg hover:bg-neutral-100"
							>カテゴリの管理</a
						>
						<a
							href="#settings-balance-adjustment"
							class="settings-menu-link block p-4 rounded-lg hover:bg-neutral-100"
							>口座残高の調整</a
						>
						<a
							href="#settings-credit-cards"
							class="settings-menu-link block p-4 rounded-lg hover:bg-neutral-100"
							>クレジットカード設定</a
						>
						<a
							href="#settings-scan"
							class="settings-menu-link block p-4 rounded-lg hover:bg-neutral-100"
							>スキャン設定</a
						>
					</div>

					<div
						id="settings-general"
						hidden
						class="settings-tab-pane p-6 space-y-6"
					>
						<div>
							<h3 class="text-lg font-semibold mb-2">プッシュ通知</h3>
							<div class="flex items-center justify-between">
								<p class="text-sm text-neutral-500 pr-4">
									リマインダーや定期レポートなどの通知を受け取ります。
								</p>
								<label class="relative cursor-pointer">
									<input
										type="checkbox"
										id="notification-toggle"
										class="sr-only peer"
									/>
									<div
										class="w-11 h-6 bg-neutral-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-0.5 after:bg-white after:border-neutral-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"
									></div>
								</label>
							</div>
						</div>

						<div class="border-t border-neutral-200"></div>

						<div>
							<h3 class="text-lg font-semibold mb-2">データ表示期間</h3>
							<p class="text-sm text-neutral-500 mb-2">
								読み込むデータ期間を制限することで、表示速度の向上と通信量の節約ができます。
							</p>
							<div
								class="flex flex-col sm:flex-row gap-3 items-start sm:items-center"
							>
								<select
									id="display-period-selector"
									name="display-period"
									aria-label="データ表示期間"
									class="w-full sm:w-auto grow h-9 text-sm border border-neutral-300 rounded-lg px-2 bg-white focus:ring-2 focus:ring-primary focus:border-primary"
								>
									<option value="3">過去3ヶ月</option>
									<option value="6">過去6ヶ月</option>
									<option value="12">過去1年 (12ヶ月)</option>
								</select>
								<button
									id="save-general-settings-button"
									aria-label="設定を適用して再読み込み"
									class="bg-primary text-white px-4 py-1.5 rounded-lg hover:bg-primary-dark text-sm font-bold whitespace-nowrap shadow-sm"
								>
									適用して再読込
								</button>
							</div>
						</div>

						<div class="pt-6 border-t border-neutral-200">
							<h3 class="text-lg font-semibold mb-2">
								AIアドバイザー機能
								<span
									class="bg-purple-100 text-purple-700 text-[10px] font-bold px-2 py-0.5 rounded border border-purple-200 ml-1 align-middle"
									>BETA</span
								>
							</h3>
							<div class="flex items-center justify-between">
								<p class="text-sm text-neutral-500 pr-4">
									取引履歴をAIが分析し、家計のアドバイスを表示します。
								</p>
								<label class="relative cursor-pointer">
									<input
										type="checkbox"
										id="ai-advisor-toggle"
										class="sr-only peer"
									/>
									<div
										class="w-11 h-6 bg-neutral-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-0.5 after:bg-white after:border-neutral-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"
									></div>
								</label>
							</div>
						</div>
					</div>

					<div
						id="settings-accounts"
						hidden
						class="settings-tab-pane p-6 space-y-6"
					>
						<div>
							<h3 class="text-lg font-semibold mb-2">資産口座</h3>
							<p class="text-sm text-neutral-500 mb-3">
								現金や銀行口座、電子マネーなどを登録します。
							</p>
							<div id="assets-list" class="space-y-2"></div>
							<button
								id="add-asset-button"
								class="mt-3 text-primary hover:text-primary-dark"
							>
								<i class="fas fa-plus-circle mr-1"></i>資産を追加
							</button>
						</div>
						<div class="pt-6 border-t border-neutral-200">
							<h3 class="text-lg font-semibold mb-2">負債口座</h3>
							<p class="text-sm text-neutral-500 mb-3">
								クレジットカードなどを登録します。
							</p>
							<div id="liabilities-list" class="space-y-2"></div>
							<button
								id="add-liability-button"
								class="mt-3 text-primary hover:text-primary-dark"
							>
								<i class="fas fa-plus-circle mr-1"></i>負債を追加
							</button>
						</div>
					</div>

					<div
						id="settings-categories"
						hidden
						class="settings-tab-pane p-6 space-y-6"
					>
						<div>
							<h3 class="text-lg font-semibold mb-2">収入カテゴリ</h3>
							<p class="text-sm text-neutral-500 mb-3">
								収入の種類を分類します。
							</p>
							<div id="income-categories-list" class="space-y-2"></div>
							<button
								id="add-income-category-button"
								class="mt-3 text-primary hover:text-primary-dark"
							>
								<i class="fas fa-plus-circle mr-1"></i>収入カテゴリを追加
							</button>
						</div>

						<div class="pt-6 border-t border-neutral-200">
							<h3 class="text-lg font-semibold mb-2">支出カテゴリ</h3>
							<p class="text-sm text-neutral-500 mb-3">
								支出の種類を分類します。
							</p>
							<div id="expense-categories-list" class="space-y-2"></div>
							<button
								id="add-expense-category-button"
								class="mt-3 text-primary hover:text-primary-dark"
							>
								<i class="fas fa-plus-circle mr-1"></i>支出カテゴリを追加
							</button>
						</div>
					</div>

					<div
						id="settings-balance-adjustment"
						hidden
						class="settings-tab-pane p-6 space-y-6"
					>
						<div>
							<h3 class="text-lg font-semibold mb-2">口座残高の調整</h3>
							<p class="text-sm text-neutral-500 mb-4">
								実際の口座残高とアプリの残高にズレがある場合、差額を調整取引として記録します。入力欄に<strong
									class="text-primary"
									>現在の正しい残高</strong
								>を入力してください。
							</p>
							<div id="balance-adjustment-list" class="space-y-3"></div>
						</div>
					</div>

					<div
						id="settings-credit-cards"
						hidden
						class="settings-tab-pane p-6 space-y-6"
					>
						<div>
							<h3 class="text-lg font-semibold mb-2">
								クレジットカード支払いルール
							</h3>
							<p class="text-sm text-neutral-500 mb-4">
								負債口座として登録したクレジットカードの締め日と支払日を設定します。
							</p>
							<div id="credit-card-rules-container" class="space-y-3"></div>
							<button
								id="add-card-rule-button"
								class="mt-4 text-primary hover:text-primary-dark"
							>
								<i class="fas fa-plus-circle mr-1"></i>新しいルールを追加
							</button>
						</div>
					</div>

					<div
						id="settings-scan"
						hidden
						class="settings-tab-pane p-6 space-y-6"
					>
						<div>
							<h3 class="text-lg font-semibold mb-2">除外キーワード</h3>
							<p class="text-sm text-neutral-500 mb-3">
								スキャン結果から自動的に除外したい取引のキーワードを設定します（例:
								「振替」「カード引き落とし」など）。
							</p>
							<div id="scan-exclude-keywords-list" class="space-y-2"></div>
							<button
								id="add-scan-exclude-keyword-button"
								class="mt-3 text-primary hover:text-primary-dark"
							>
								<i class="fas fa-plus-circle mr-1"></i>除外キーワードを追加
							</button>
						</div>

						<div class="pt-6 border-t border-neutral-200">
							<h3 class="text-lg font-semibold mb-2">カテゴリ分類ルール</h3>
							<p class="text-sm text-neutral-500 mb-3">
								特定のキーワードが含まれる取引のカテゴリを自動的に設定します。
							</p>
							<div id="scan-category-rules-list" class="space-y-2"></div>
							<button
								id="add-scan-category-rule-button"
								class="mt-3 text-primary hover:text-primary-dark"
							>
								<i class="fas fa-plus-circle mr-1"></i>分類ルールを追加
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div
			id="icon-picker-modal"
			hidden
			class="fixed inset-0 modal-overlay z-60 flex justify-center items-center p-4"
		>
			<div class="bg-white rounded-lg shadow-xl w-full max-w-lg">
				<div class="p-4 border-b border-neutral-200">
					<h3 class="font-bold text-lg text-neutral-900">アイコンを選択</h3>
				</div>
				<div
					id="icon-picker-grid"
					class="p-4 grid grid-cols-6 sm:grid-cols-8 md:grid-cols-10 gap-2 max-h-[60vh] overflow-y-auto"
				></div>
			</div>
		</div>

		<div
			id="scan-start-modal"
			hidden
			class="fixed inset-0 modal-overlay z-70 flex justify-center items-center p-4"
		>
			<div
				class="bg-white rounded-lg shadow-xl w-full max-w-sm p-6 text-center relative"
			>
				<ww-button
					id="close-scan-start-button"
					variant="icon"
					class="absolute top-4 right-4"
					extra-class="text-neutral-400 hover:text-neutral-600 p-1"
					aria-label="スキャンを中止して閉じる"
				>
					<i class="fas fa-times text-xl"></i>
				</ww-button>

				<h3 class="font-bold text-xl text-neutral-900 mb-1">
					AIで画像を読み取る
				</h3>

				<div class="flex items-center justify-center gap-2 mb-6">
					<span
						class="bg-purple-100 text-purple-700 text-[10px] font-extrabold px-2 py-0.5 rounded border border-purple-200"
						>BETA</span
					>
					<span
						class="text-xs text-neutral-600 font-medium flex items-center gap-1"
					>
						Powered by <i class="fas fa-bolt text-yellow-400"></i> Gemini 2.5
						Flash
					</span>
				</div>

				<div id="scan-start-content" class="space-y-6">
					<div
						class="border-2 border-dashed border-neutral-300 rounded-xl p-8 bg-neutral-50"
					>
						<p class="text-neutral-500 text-sm mb-4">
							レシートや明細書の<br />画像を選択してください
						</p>
						<div class="flex justify-center gap-4">
							<button
								id="scan-camera-button"
								aria-label="カメラを起動して撮影する"
								class="flex flex-col items-center justify-center w-20 h-20 bg-white border border-neutral-200 rounded-lg shadow-sm hover:bg-primary-light hover:border-primary transition"
							>
								<i class="fas fa-camera text-2xl text-primary mb-2"></i>
								<span class="text-xs font-bold text-neutral-600">カメラ</span>
							</button>
							<button
								id="scan-upload-button"
								aria-label="アルバムから画像を選択する"
								class="flex flex-col items-center justify-center w-20 h-20 bg-white border border-neutral-200 rounded-lg shadow-sm hover:bg-success-light hover:border-success transition"
							>
								<i class="fas fa-images text-2xl text-success mb-2"></i>
								<span class="text-xs font-bold text-neutral-600">アルバム</span>
							</button>
						</div>
					</div>
				</div>

				<div id="scan-loading-content" hidden class="py-8">
					<div class="relative w-20 h-20 mx-auto mb-4">
						<div
							class="absolute inset-0 border-4 border-neutral-200 rounded-full"
						></div>
						<div
							class="absolute inset-0 border-4 border-primary rounded-full border-t-transparent animate-spin"
						></div>
						<i
							class="fas fa-robot absolute inset-0 m-auto w-fit h-fit text-2xl text-neutral-400"
						></i>
					</div>
					<p class="font-bold text-neutral-900">Geminiが解析中...</p>
					<p class="text-sm text-neutral-600 mt-2">数秒お待ちください</p>

					<button
						type="button"
						id="scan-cancel-analysis-button"
						aria-label="解析をキャンセルする"
						class="mt-6 text-sm text-neutral-600 hover:text-neutral-800 underline"
					>
						キャンセル
					</button>
				</div>

				<input
					type="file"
					id="scan-file-camera"
					accept="image/*"
					capture="environment"
					hidden
				/>
				<input type="file" id="scan-file-upload" accept="image/*" hidden />
			</div>
		</div>

		<div
			id="scan-confirm-modal"
			hidden
			class="fixed inset-0 modal-overlay z-60 flex justify-center items-center p-4"
		>
			<div
				class="bg-white rounded-lg shadow-xl w-full max-w-md flex flex-col max-h-[90vh]"
			>
				<div
					class="px-5 py-4 border-b border-neutral-200 flex justify-between items-center shrink-0"
				>
					<h3 class="font-bold text-xl text-neutral-900">
						<i class="fas fa-robot text-primary mr-2"></i>確認と登録
					</h3>
					<ww-button
						id="close-scan-confirm-button"
						variant="icon"
						extra-class="w-8 h-8 p-1 rounded-full hover:bg-neutral-100"
						aria-label="確認を中止して閉じる"
					>
						<i class="fas fa-times text-xl"></i>
					</ww-button>
				</div>

				<div class="grow overflow-y-auto px-5 py-4 space-y-4">
					<div
						id="scan-viewer-container"
						class="w-full h-80 bg-gray-900 rounded-lg relative overflow-hidden cursor-grab active:cursor-grabbing group touch-none border border-neutral-300"
					>
						<img
							id="scan-viewer-image"
							src=""
							alt="Receipt"
							class="absolute top-0 left-0 origin-top-left pointer-events-none will-change-transform"
						/>
					</div>
					<div
						class="bg-primary-light p-3 rounded-lg border border-primary-ring"
					>
						<ww-select
							id="scan-global-account"
							label="支払方法"
							aria-label="一括で設定する支払方法"
						></ww-select>
					</div>

					<div id="scan-results-list" class="space-y-4"></div>

					<ww-button
						id="add-scan-row-button"
						variant="dashed"
						extra-class="w-full justify-center"
						aria-label="新しい取引行を追加する"
					>
						<i class="fas fa-plus mr-1"></i> 取引を追加
					</ww-button>
				</div>

				<div
					class="px-5 py-4 border-t border-neutral-200 flex justify-end gap-3 shrink-0 bg-white rounded-b-lg"
				>
					<ww-button
						id="cancel-scan-button"
						variant="secondary"
						aria-label="スキャン結果の登録をキャンセル"
					>
						キャンセル
					</ww-button>
					<ww-button
						id="register-scan-button"
						variant="primary"
						aria-label="スキャン結果を一括登録する"
					>
						<i class="fas fa-check mr-2"></i> 一括登録
					</ww-button>
				</div>
			</div>
		</div>

		<div
			id="report-modal"
			hidden
			class="fixed inset-0 modal-overlay z-50 flex justify-center items-center p-0 md:p-4"
		>
			<div
				class="bg-white w-full h-full md:h-auto md:max-w-3xl md:max-h-[90vh] md:rounded-lg md:shadow-xl flex flex-col"
			>
				<div
					class="p-4 border-b border-neutral-200 flex items-center justify-between shrink-0 md:rounded-t-lg bg-white"
				>
					<div class="flex items-center gap-3">
						<i class="fas fa-file-invoice-dollar text-primary text-xl"></i>
						<h2 class="text-xl font-bold text-neutral-900">年間収支レポート</h2>
					</div>
					<ww-button
						id="close-report-modal-button"
						variant="icon"
						extra-class="w-8 h-8 rounded-full hover:bg-neutral-100 p-1"
						aria-label="レポートを閉じる"
					>
						<i class="fas fa-times text-2xl"></i>
					</ww-button>
				</div>

				<div
					class="p-4 bg-neutral-50 border-b border-neutral-200 flex flex-wrap gap-4 items-center justify-between shrink-0"
				>
					<div class="flex items-center gap-2">
						<label for="report-year-select" class="font-bold text-neutral-900"
							>対象年:</label
						>
						<ww-select
							id="report-year-select"
							aria-label="レポートの対象年"
							class="h-9 w-32"
						></ww-select>
					</div>
					<ww-button
						id="export-csv-button"
						variant="success"
						aria-label="レポートをCSV形式でダウンロード"
					>
						<i class="fas fa-download"></i> CSV出力
					</ww-button>
				</div>

				<div class="grow overflow-y-auto p-4 md:p-6">
					<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
						<div
							class="bg-primary-light p-4 rounded-xl border border-primary-ring"
						>
							<p class="text-sm text-primary-dark font-bold mb-1">年間総収入</p>
							<p
								id="report-total-income"
								class="text-2xl font-bold text-primary"
							>
								---
							</p>
						</div>
						<div
							class="bg-danger-light p-4 rounded-xl border border-danger-light"
						>
							<p class="text-sm text-danger-dark font-bold mb-1">年間総支出</p>
							<p
								id="report-total-expense"
								class="text-2xl font-bold text-danger"
							>
								---
							</p>
						</div>
						<div
							class="bg-neutral-100 p-4 rounded-xl border border-neutral-200"
						>
							<p class="text-sm text-neutral-600 font-bold mb-1">年間収支差</p>
							<p
								id="report-total-balance"
								class="text-2xl font-bold text-neutral-800"
							>
								---
							</p>
						</div>
					</div>

					<div class="space-y-6">
						<div>
							<h3
								class="text-lg font-bold text-neutral-700 mb-3 border-l-4 border-primary pl-3"
							>
								勘定科目別（カテゴリ別）集計
							</h3>
							<div class="overflow-x-auto">
								<table
									class="w-full text-sm text-left text-neutral-600 border border-neutral-200 rounded-lg min-w-75"
								>
									<thead
										class="text-xs text-neutral-700 uppercase bg-neutral-100 border-b border-neutral-200"
									>
										<tr>
											<th class="px-3 md:px-6 py-3">カテゴリ名</th>
											<th class="px-3 md:px-6 py-3 text-right">金額</th>
											<th class="px-3 md:px-6 py-3 text-right">構成比</th>
										</tr>
									</thead>
									<tbody
										id="report-details-body"
										class="divide-y divide-neutral-200"
									></tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div
			id="terms-modal"
			hidden
			class="fixed inset-0 modal-overlay z-99 flex justify-center items-center p-0 md:p-4"
		>
			<div
				class="bg-white w-full h-full md:h-auto md:max-w-3xl md:max-h-[90vh] md:rounded-lg md:shadow-xl flex flex-col"
			>
				<div
					class="p-4 border-b border-neutral-200 shrink-0 flex justify-between items-center md:rounded-t-lg"
				>
					<h2 id="terms-modal-title" class="text-xl font-bold text-neutral-900">
						利用規約
					</h2>
					<ww-button
						id="close-terms-modal-button"
						variant="icon"
						extra-class="w-8 h-8 rounded-full hover:bg-neutral-100 shrink-0 p-1"
						hidden
						aria-label="利用規約を閉じる"
					>
						<i class="fas fa-times text-2xl"></i>
					</ww-button>
				</div>
				<div
					id="terms-content"
					class="grow overflow-y-auto p-6 space-y-4 max-w-3xl mx-auto w-full"
				>
					<p>利用規約を読み込んでいます...</p>
				</div>
				<div
					class="p-4 bg-white border-t border-neutral-200 flex justify-end gap-3 shrink-0 md:rounded-b-lg"
				>
					<ww-button
						id="terms-disagree-btn"
						variant="secondary"
						aria-label="利用規約に同意しない"
					>
						同意しない
					</ww-button>
					<ww-button
						id="terms-agree-btn"
						variant="primary"
						aria-label="利用規約に同意する"
					>
						同意する
					</ww-button>
				</div>
			</div>
		</div>

		<script type="module" src="js/components.js"></script>
		<script type="module" src="js/main.js"></script>
	</body>
</html>
